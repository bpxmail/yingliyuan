<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1/4桥</title>
    <style>
        canvas {
            touch-action: none;
            border: 1px solid black;
            position: absolute;
        }

        #canvasbg {
            z-index: 1;
        }

        #canvasline {
            z-index: 2;
        }

        p {
            width: 330px;
            text-indent: 2em;
        }
    </style>
</head>

<body>
    <div id="div1">
        <canvas id="canvasbg">canvas not supported</canvas>
        <canvas id="canvasline">canvas not supported</canvas>
    </div>
    <p id="pid">α-β-γ-δ-ε-ζ-η-θ-ι-κ-λ-μ-ν-ξ-ο-π-ρ-σ-τ-υ-φ-χ-ψ-ω</p>

    <script>
        let canvasbg = document.getElementById("canvasbg");
        let canvasline = document.getElementById("canvasline");
        let ctxbg = canvasbg.getContext("2d");
        let ctxline = canvasline.getContext("2d");
        let p = document.getElementById("pid");
        let div1 = document.getElementById("div1");

        // 画布大小
        setsize();
        let w = canvasbg.width;
        let h = canvasbg.height;

        // 绘制工作通道
        let imgbg = new Image();
        imgbg.src = "./images/qiaolu1.png";
        imgbg.onload = function () {
            ctxbg.drawImage(imgbg, 0, 0, w, h);
            // ctxbg.fillRect(pt1.x - 5, pt1.y - 5, 100, 100);
        };


        // pt1是工作片左点，pt2是工作片右点
        // pt3是白线补偿片左点，pt4是白线补偿片右点
        // pt5是黑线补偿片左点，pt6是黑线补偿片右点
        let pt1 = { x: 140 / 833 * w, y: 253 / 788 * h };
        let pt2 = { x: 255 / 833 * w, y: 253 / 788 * h };
        let pt3 = { x: 552/ 833 * w, y: 253/ 788 * h };
        let pt4 = { x: 633/ 833 * w, y: 253/ 788 * h };
        let pt5 = { x: 699/ 833 * w, y: 253/ 788 * h };
        let pt6 = { x: 773/ 833 * w, y: 253 / 788 * h};
        let dragging = false; // 鼠标是否正在拖动

        ctxbg.fillStyle = "rgb(237, 67, 120)";


        draw();



        function draw() {
            ctxline.clearRect(0, 0, w, h);

            ctxline.strokeStyle = "rgb(237, 67, 120)";
            ctxline.lineWidth = 2;
            ctxline.beginPath();
            ctxline.moveTo(pt1.x, pt1.y);
            ctxline.lineTo(0, 0);
            ctxline.stroke();

        }

        // 判断当前设备是否为移动设备
        function isMobile() {
            const userAgent = navigator.userAgent.toLowerCase();
            return /iphone|ipod|android|blackberry|windows phone|mobile/i.test(userAgent);
        }

        // 判断当前设备是否为横屏
        function isLandscape() {
            return window.orientation === 90 || window.orientation === -90;
        }

        // 根据设备类型设置画布大小
        function setsize() {
            // if (isMobile() && !isLandscape()) {
            //     // 如果是移动设备且为竖屏
            //     canvasbg.width = 330;
            //     p.textContent = '竖屏-' + canvasbg.width;

            // }
            // else if (!isMobile() || isLandscape()) {
            //     // 如果是移动设备且为横屏，或者是PC
            //     canvasbg.width = 500;
            //     p.textContent = '横屏||PC-' + canvasbg.width;
            // }
            if(!isMobile()){
                canvasbg.width = 500;
                p.textContent = 'PC-' + canvasbg.width;
            }
            else if(isLandscape()){
                canvasbg.width = 400;
                p.textContent = '横屏-' + canvasbg.width;
            }
            else {
                canvasbg.width = 330;
                p.textContent = '竖屏-' + canvasbg.width;
            }
            canvasbg.height = Math.round(canvasbg.width * 788 / 833);
            div1.style.width = canvasbg.width + "px";
            div1.style.height = canvasbg.height + "px";
            canvasline.width = canvasbg.width;
            canvasline.height = canvasbg.height;
            ctxbg.drawImage(imgbg, 0, 0, w, h);
        }

        window.addEventListener("orientationchange", setsize);

        canvasline.addEventListener("pointerdown", function (event) {
            // 检查鼠标是否点击在移动点附近
            // let dx = event.offsetX - pt.x;
            // let dy = event.offsetY - pt.y;
            // if (Math.sqrt(dx * dx + dy * dy) < 15) {
            //     dragging = true;
            // }
        });

        canvasline.addEventListener('pointermove', (event) => {
            // event.preventDefault(); // 防止默认行为
            // if (dragging) {
            //     angle = -Math.atan2(event.offsetY - circ.y, event.offsetX - circ.x) * 180 / Math.PI;
            //     angle = ((angle - angle0) % 360 + 360) % 360 + angle0;
            //     angle = Math.round(angle * 10) / 10;
            // }
            draw(); // 重绘
        });

        canvaslinea.ddEventListener('pointerup', (event) => {
            // dragging = false;
            draw(); // 重绘
        });

        canvasline.addEventListener('pointerleave', (event) => {
            // dragging = false;
            draw(); // 重绘
        });
    </script>
</body>

</html>
